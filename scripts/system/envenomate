# Copyright (c) 2019, Firas Khalil Khana
# Distributed under the terms of the ISC License

envenomate() {
  for ceras in $@; do
    install -dv $SCER/$ceras/sac $SCER/$ceras/venom

    . $CERD/$ceras/ceras/ceras
    . $CERD/$ceras/ceras/system.ceras
    
    prepare_system || { echo system $ceras prepare failed; exit $?;  }
    configure_system || { echo system $ceras configure failed; exit $?; }
    build_system || { echo system $ceras build failed; exit $?; }
    install_system || { echo system $ceras install failed; exit $?; }

    cd $SCER/$ceras/sac
    
    sha512sum $(tar cJvf ../venom/$name-$version-$release-$arch.tar.xz . | sed \
      -e 's/\.\///' -e '/\/$/d' | sort) > ../venom/checksum
    tar xvf $SCER/$ceras/venom/$name-$version-$release-$arch.tar.xz -C /
    rsync -vah $SCER/$ceras/venom /usr/cerata/$name --delete
  done
}

#envenomate skalibs execline s6 utmps
#envenomate libressl
envenomate toybox
#envenomate smdev nldev nlmon
#envenomate netbsd-curses procps dash oksh
#envenomate e2fsprogs
#envenomate linux
#envenomate s6-linux-init s6-rc glaucus-s6-boot-scripts

#envenomate re2c
#envenomate sinit svc
#envenomate sdhcp
#envenomate bzip2 xz zlib libarchive
#envenomate pcre2 less mandoc vim
#envenomate file iproute2 opendoas libressl
#envenomate expat libffi wayland wayland-protocols
#envenomate jemalloc
#envenomate bin86 lilo
#envenomate s6-linux-utils s6-portable-utils nsss

#envenomate bzip2 zlib libpng freetype_1 libelf-compat pcre glib harfbuzz freetype_2 expat json-c fontconfig
#envenomate util-macros
#envenomate xorgproto libXau libXdmcp xcbproto libxcb
#envenomate libxtrans libX11 libXext libFS libICE libSM libXScrnSaver libXt libXmu libXpm libXaw libXfixes libXcomposite libXrender libXcursor libXdamage libfontenc libXfont libXft libXi libXinerama libXrandr libXRes libXtst libXv libXvMC libXxf86dga libXxf86vm libdmx libpciaccess libxkbfile libxshmfence
#envenomate libxcb-util libxcb-image libxcb-keysyms libxcb-render-util libxcb-wm libxcb-cursor
#envenomate pixman cairo
#envenomate fribidi libdatrie libthai pango
