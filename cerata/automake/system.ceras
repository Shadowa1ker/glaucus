# Copyright (c) 2019-2020, Firas Khalil Khana
# Distributed under the terms of the ISC License

# Voyager: Firas Khalil Khana (firasuke) <firasuke@glaucuslinux.org>

prepare_system() {
  $RSYNC $SRCD/$nom/$nom-$ver/ $SSRC/$nom --delete &&
  cd $SSRC/$nom &&

  $SCRD/patch 1 $nom upstream 0002-bin-Rely-only-on-the-shebang-line.patch &&
  $SCRD/patch 1 $nom upstream 0007-python-Don-t-use-n-in-sed-substitution.patch &&
  $SCRD/patch 1 $nom upstream 0008-doc-Fix-various-typos-and-phrasing.patch &&
  $SCRD/patch 1 $nom upstream 0009-ar-lib-Fix-for-MSVC-14.patch &&
  $SCRD/patch 1 $nom upstream 0010-install-sh-support-s-with-read-only-source.patch &&
  $SCRD/patch 1 $nom upstream 0012-maint-make-fetch.patch &&
  $SCRD/patch 1 $nom upstream 0014-config-add-msys-support.patch &&
  $SCRD/patch 1 $nom upstream 0015-dist-add-dist-zstd-option.patch &&
  $SCRD/patch 1 $nom upstream 0018-maint-make-maintainer-check-tests-pass.patch &&
  $SCRD/patch 1 $nom upstream 0020-automake-Support-byte-compilation-in-older-Emacsen.patch &&
  $SCRD/patch 1 $nom upstream 0021-tests-Correctly-simulate-no-emacs-in-t-nobase-nodist.patch &&
  $SCRD/patch 1 $nom upstream 0022-tests-use-skip_-consistently.patch &&
  $SCRD/patch 1 $nom upstream 0023-tests-use-find-rm-not-perl-to-remove-temporary-direc.patch &&
  $SCRD/patch 1 $nom upstream 0024-lint-make-syntax-check-same-as-maintainer-check.patch &&
  $SCRD/patch 1 $nom upstream 0025-doc-clarify-build-tree-location.patch
}

configure_system() {
  ./configure \
    --prefix=/usr
}

build_system() {
  make
}

install_system() {
  make \
    DESTDIR=$SCER/$nom/sac \
    install-strip
}
