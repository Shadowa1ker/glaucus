From eec6ab7615535e02cfcb691d44575268bdcf656f Mon Sep 17 00:00:00 2001
From: Wayne Davison <wayned@samba.org>
Date: Sun, 25 Mar 2018 19:07:22 -0700
Subject: [PATCH 03/36] Avoid a compiler error/warning about shifting a
 negative value. Fixes bug #13268.

---
 NEWS           | 3 ++-
 zlib/inflate.c | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/NEWS b/NEWS
index 4fe6d9cb..792df231 100644
--- a/NEWS
+++ b/NEWS
@@ -4,7 +4,8 @@ Changes since 3.1.3:
 
   BUG FIXES:
 
-    - ...
+    - Fix a compiler error/warning about shifting a negative value (in the zlib
+      code).
 
   ENHANCEMENTS:
 
diff --git a/zlib/inflate.c b/zlib/inflate.c
index a7555738..cea8e7e4 100644
--- a/zlib/inflate.c
+++ b/zlib/inflate.c
@@ -1525,7 +1525,7 @@ z_streamp strm;
 {
     struct inflate_state FAR *state;
 
-    if (strm == Z_NULL || strm->state == Z_NULL) return -1L << 16;
+    if (strm == Z_NULL || strm->state == Z_NULL) return -(1L << 16);
     state = (struct inflate_state FAR *)strm->state;
     return ((long)(state->back) << 16) +
         (state->mode == COPY ? state->length :
-- 
2.25.0

