name=linux
version=4.19.5
release=1
description='The Linux kernel and modules'
arch=x86_64
url=https://cdn.kernel.org/pub/$name/kernel/v4.x/$name-$version.tar.xz
license=GPLv2
checksum=ee460800a071aeae966078d3e7dc525e1e8e9cbb406fe878438c55da4ea42d10f50c0ebfcf3ee4c792f3cc984ee8d8d3acdb8ca6bc11536fa6a4391de58643fb

build_toolchain () {
	tar xvf $CERD/$name/$name-$version.tar.xz -C $TMPD/toolchain/sources
	cd $TMPD/toolchain/sources/$name-$version
	make mrproper
        make O=$TMPD/toolchain/builds/$name ARCH=$ARCH headers_check
        make O=$TMPD/toolchain/builds/$name ARCH=$ARCH INSTALL_HDR_PATH=$PRFX/$TRPL headers_install
}

build () {
	tar xvf $CERD/$name/$name-$version.tar.xz -C $TMPD/system/sources
	mkdir -v $TMPD/system/builds/$name
	cp -av $CERD/$name/glaucus.config $TMPD/system/builds/$name/.config
	cd $TMPD/system/sources/$name-$version
	make mrproper
	make O=$TMPD/system/builds/$name ARCH=$ARCH CROSS_COMPILE=$TRPL- oldconfig
	make O=$TMPD/system/builds/$name ARCH=$ARCH CROSS_COMPILE=$TRPL- prepare
	make O=$TMPD/system/builds/$name ARCH=$ARCH CROSS_COMPILE=$TRPL-
	cat $TMPD/system/builds/$name/arch/x86/boot/bzImage > $GLAD/boot/vmlinuz
	cp -av $TMPD/system/builds/$name/System.map $GLAD/boot
}
