name=musl
version=git
release=1
arch=x86-64
url=https://$version.$name-libc.org/c$version/$name
description='An implementation of the standard library functionality described in the ISO C and POSIX standards, plus common extensions, intended for use on Linux-based systems'
cluster=core
license='BSDv2 LGPLv2.1+ MIT PD'
build_toolchain(){
        mkdir -v $TBLD/$name
        cd $TBLD/$name
        $CERD/$name/$name/configure \
                CROSS_COMPILE=$TUPL- \
                --prefix=$TOOL/$TUPL \
                --syslibdir=/usr/lib \
                --target=$TUPL \
                --disable-wrapper \
                --disable-static
        rm -fv Makefile
        cp -arv $CERD/$name/$name/Makefile .
        sed 's/$(INSTALL) -D -l/sudo &/' \
                -i Makefile
        make
        sudo make install
}
build(){
        mkdir -v $SBLD/$name
        cd $SBLD/$name
        $CERD/$name/$name/configure \
                CFLAGS="$CFLAGSNOLTO" \
                --prefix=/usr \
                --syslibdir=/usr/lib \
                --target=$TUPL \
                --host=$TUPL \
                --build=$TUPL \
                --disable-wrapper \
                --disable-static
        make
        make DESTDIR=$SCER/$name/sac \
                install-libs
        install -dv $SCER/$name/sac/usr/bin
        cd $SCER/$name/sac/usr/bin
        ln -fsv ../lib/ld-musl-x86_64.so.1 ldd
        $STRIP -v $SCER/$name/sac/usr/lib/Scrt1.o \
                $SCER/$name/sac/usr/lib/crt1.o \
                $SCER/$name/sac/usr/lib/crti.o \
                $SCER/$name/sac/usr/lib/crtn.o \
                $SCER/$name/sac/usr/lib/rcrt1.o
}
