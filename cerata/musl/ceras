name=musl
version=1.1.20
release=1
description='An implementation of the standard library functionality described in the ISO C and POSIX standards, plus common extensions, intended for use on Linux-based systems'
arch=x86_64
url=http://www.$name-libc.org/releases/$name-$version.tar.gz
license='BSDv2 LGPLv2.1+ MIT PD'
checksum=d3a7a30aa375ca50d7dcfbd618581d59e1aa5378417f50a0ca5510099336fd74cc9db468e05c93dda3067abd890f6bd47af226c3446bb833adf0a5054bff2e5d

build_toolchain () {
	tar xvf $CERD/$name/$name-$version.tar.gz -C $TMPD/toolchain/sources
	cd $TMPD/toolchain/builds/$name
	$TMPD/toolchain/sources/$name-$version/configure \
                CC=$TRPL-gcc \
                CROSS_COMPILE=$TRPL- \
                --prefix=/ \
                --target=$TRPL \
                --disable-debug \
                --disable-warnings
        make
        make DESTDIR=$PRFX/$TRPL install
}

build () {
	tar xvf $CERD/$name/$name-$version.tar.gz -C $TMPD/system/sources
	mkdir $TMPD/system/builds/$name
	cd $TMPD/system/builds/$name
	$TMPD/system/sources/$name-$version/configure \
		CFLAGS="$CFLAGS" \
		LDFLAGS="$LDFLAGS" \
		CROSS_COMPILE=$TRPL- \
		--prefix= \
		--target=$TRPL \
		--disable-debug \
		--disable-warnings \
		--disable-static \
		--without-libpam \
		--without-audit \
		--without-selinux \
		--without-nscd
	make
	make DESTDIR=$GLAD install-libs
	$STRIP -v $GLAD/lib/Scrt1.o \
		$GLAD/lib/crt1.o \
		$GLAD/lib/crti.o \
		$GLAD/lib/crtn.o \
		$GLAD/lib/rcrt1.o
}
