From 76f2beee810aa0a6bee3fe63e33fa170961e565d Mon Sep 17 00:00:00 2001
From: Sebastian Pipping <sebastian@pipping.org>
Date: Sun, 29 Sep 2019 19:31:04 +0200
Subject: [PATCH 04/41] runtests.c: Fix compiler warning "unused function" with
 -DEXPAT_MIN_SIZE=ON

---
 expat/tests/runtests.c | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/expat/tests/runtests.c b/expat/tests/runtests.c
index b7411e9..88a45de 100644
--- a/expat/tests/runtests.c
+++ b/expat/tests/runtests.c
@@ -2255,6 +2255,7 @@ START_TEST(test_long_cdata_utf16) {
 END_TEST
 
 /* Test handling of multiple unit UTF-16 characters */
+#ifndef XML_MIN_SIZE /* FIXME workaround -DXML_MIN_SIZE + ASan (issue #332) */
 START_TEST(test_multichar_cdata_utf16) {
   /* Test data is:
    *   <?xml version='1.0' encoding='utf-16'?>
@@ -2276,11 +2277,11 @@ START_TEST(test_multichar_cdata_utf16) {
                       "\0<\0a\0>\0<\0!\0[\0C\0D\0A\0T\0A\0["
                       "\xd8\x34\xdd\x5e\xd8\x34\xdd\x5f"
                       "\0]\0]\0>\0<\0/\0a\0>";
-#ifdef XML_UNICODE
+#  ifdef XML_UNICODE
   const XML_Char *expected = XCS("\xd834\xdd5e\xd834\xdd5f");
-#else
+#  else
   const XML_Char *expected = XCS("\xf0\x9d\x85\x9e\xf0\x9d\x85\x9f");
-#endif
+#  endif
   CharData storage;
 
   CharData_Init(&storage);
@@ -2293,6 +2294,7 @@ START_TEST(test_multichar_cdata_utf16) {
   CharData_CheckXMLChars(&storage, expected);
 }
 END_TEST
+#endif /* ifndef XML_MIN_SIZE */
 
 /* Test that an element name with a UTF-16 surrogate pair is rejected */
 START_TEST(test_utf16_bad_surrogate_pair) {
@@ -2377,6 +2379,7 @@ START_TEST(test_bad_cdata) {
 END_TEST
 
 /* Test failures in UTF-16 CDATA */
+#ifndef XML_MIN_SIZE /* FIXME workaround -DXML_MIN_SIZE + ASan (issue #332) */
 START_TEST(test_bad_cdata_utf16) {
   struct CaseData {
     size_t text_bytes;
@@ -2449,6 +2452,7 @@ START_TEST(test_bad_cdata_utf16) {
   }
 }
 END_TEST
+#endif /* ifndef XML_MIN_SIZE */
 
 static const char *long_cdata_text
     = "<s><![CDATA["
-- 
2.25.0

