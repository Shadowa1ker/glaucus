version=1.44.4
url=https://mirrors.edge.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/v$version/e2fsprogs-$version.tar.xz

build_system () {
	tar xfv $CERD/e2fsprogs/e2fsprogs-$version.tar.xz -C $TMPD/system/sources

	cd $TMPD/system/sources/e2fsprogs-$version
	patch -p1 -i $CERD/e2fsprogs/patches/e2fsprogs.patch
	CC=$CC LD=$LD CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS" ./configure \
		--prefix= \
		--build=$TRPL \
		--host=$TRPL \
		--host=$TRPL \
		--with-root-prefix= \
		--enable-symlink-install \
		--enable-elf-shlibs \
		--disable-bsd-shlibs \
		--disable-testio-debug \
		--disable-e2initrd-helper \
		--disable-tdb \
		--disable-nls \
		--disable-fuse2fs \
		--disable-debugfs \
		--disable-defrag \
		--disable-imager \
		--disable-mmp \
		--disable-resizer \
		--enable-fsck
	CC=$CC LD=$LD CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS" make
	
	cd lib/
	for dir in blkid e2p et ext2fs uuid
	do
		cd $dir
		make DESTDIR=$GLAD install
		cd ..
	done

	cd ..
	cp e2fsck/e2fsck $GLAD/bin
	cp misc/blkid $GLAD/bin
	cp misc/chattr $GLAD/bin
	cp misc/fsck $GLAD/bin
	cp misc/lsattr $GLAD/bin
	cp misc/mke2fs $GLAD/bin
	cp misc/tune2fs $GLAD/bin

	cd $GLAD/bin
	ln -sf e2fsck fsck.ext4
	ln -sf mke2fs mkfs.ext4
}
