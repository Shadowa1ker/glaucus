name=e2fsprogs
version=git
release=1
arch=x86_64
url=https://$version.kernel.org/pub/scm/fs/ext2/$name.$version
cysts='musl mawk'
description='The standard utilities for ext2/ext3/ext4 filesystems'
license='BSDv3 GPLv2 LGPLv2 MIT'
build(){
        rsync -vah $CERD/$name/$name $SSRC --delete
        cd $SSRC/$name
        patch -p1 -i $CERD/$name/patches/$name.patch
        CFLAGS="$CFLAGS -I$GLAD/include" \
        LIBS=-L$GLAD/lib \
        ./configure \
                --prefix= \
                --build=$TUPL \
                --host=$TUPL \
                --target=$TUPL \
                --enable-symlink-install \
                --enable-elf-shlibs \
                --disable-bsd-shlibs \
                --disable-testio-debug \
                --disable-debugfs \
                --disable-imager \
                --disable-resizer \
                --disable-defrag \
                --enable-fsck \
                --disable-uuidd \
                --disable-mmp \
                --disable-tdb \
                --disable-nls \
                --disable-fuse2fs \
                --with-root-prefix=
        make
        cd lib/
        for dir in blkid e2p et ext2fs uuid
        do
                cd $dir
                sed -e '/LDCONFIG/d' \
                        -i Makefile
                if [ ! -d $SCER/$name/sac/share/man/man3 ]
                then
                        install -dv $SCER/$name/sac/share/man/man3
                fi
                make \
                        DESTDIR=$SCER/$name/sac \
                        install-strip
                cd ..
        done
        cd ..
        install -Dv e2fsck/e2fsck misc/blkid misc/chattr misc/fsck misc/lsattr misc/mke2fs misc/tune2fs -t $SCER/$name/sac/bin
        cd $SCER/$name/sac/bin
        ln -fsv e2fsck fsck.ext4
        ln -fsv mke2fs mkfs.ext4
        sed -e 's/\/home\/glaucus\/system//' \
                -i compile_et
        cd ../lib
        rm -frv libblkid.a \
                libcom_err.a \
                libe2p.a \
                libext2fs \
                libuuid.a
}
