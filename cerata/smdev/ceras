name=smdev
version=git
release=1
arch=x86_64
url=https://$version.suckless.org/$name
description='Suckless mdev'
license=MIT
build(){
        rsync -vah $CERD/$name/$name $SSRC --delete
        rsync -vah $CERD/$name/config.h $SSRC --delete
        cd $SSRC/$name
        patch -Np1 -i $CERD/$name/patches/$name.patch
        sed -e 's/PREFIX = .*/PREFIX =/' \
                -e "s/CC = .*/CC = $CC/" \
                -e "s/CFLAGS   = .*/CFLAGS = $CFLAGS -std=c99 -Wall -pedantic -D_BSD_SOURCE -D_GNU_SOURCE/" \
                -e "s/LDFLAGS  = .*/LDFLAGS = $LDFLAGS/" \
                -i config.mk
        make
        make \
                DESTDIR=$SCER/$name/sac \
                install
        install -m 744 -Dv $SCER/$name/proceeddev $SCER/$name/sac/etc/$name/proceeddev
        install -m 644 -Dv $SCER/$name/00-modprobe \
                $SCER/$name/01-uuid \
                $SCER/$name/10-cdrom \
                $SCER/$name/20-pci \
                $SCER/$name/20-platform \
                -t $SCER/$name/sac/etc/$name/add
        install -m 644 -Dv $SCER/$name/99-remove_links $SCER/$name/sac/etc/$name/remove
}
