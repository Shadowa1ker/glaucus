name=lobase
version=git
release=1
arch=x86-64
url=https://$version.duncano.de/$name
cysts='musl mawk'
description='A port of the OpenBSD userland to Linux'
cluster=core
licenses='ISC PD'

prepare_system() {
  rsync -vah $CERD/$name/$name $SSRC --delete
  cd $SSRC/$name
}

configure_system() {
  autoreconf -vfi
  ./configure \
    --prefix=/usr \
    --build=$TUPL \
    --host=$TUPL \
    --target=$TUPL
}

build_system() {
  for dir in lib/libopenbsd lib/liboutil bin/ls bin/pax bin/stty usr.bin/diff \
    usr.bin/fmt usr.bin/patch usr.bin/sort; do
    cd $dir

    make

    cd ../..
  done
}

install_system() {
  for dir in bin/ls bin/stty usr.bin/diff usr.bin/fmt usr.bin/patch \
    usr.bin/sort; do
    cd $dir

    make \
      BINDIR=/usr/bin \
      DESTDIR=$SCER/$name/sac \
      install

    cd ../..
  done

  install -v bin/pax/pax $SCER/$name/sac/usr/bin
  install -m 444 -Dv bin/pax/cpio.1 bin/pax/pax.1 bin/pax/tar.1 -t \
    $SCER/$name/sac/usr/share/man/man1

  cd $SCER/$name/sac/usr/bin
  ln -fsv pax cpio
  ln -fsv pax tar
}
