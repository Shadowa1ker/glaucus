name=lobase
version=git
release=1
description='A port of the OpenBSD userland to Linux'
arch=x86_64
url=https://github.com/Duncaen/$name
license='ISC PD'

build () {
	cp -rav $CERD/$name/$name $TMPD/system/sources
	cd $TMPD/system/sources/$name
	sed -i -e 's/${DESTDIR}//' \
		-e 's/$$s//' \
		-e '10d' \
		mk/bsd.man.mk
	autoreconf -fi
	AR=$AR CC=$CC RANLIB=$RANLIB CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS" ./configure --prefix=
	cd lib/libopenbsd
	make
	cd ../liboutil
	make
	cd ../../usr.bin/diff
	make
	make DESTDIR=$GLAD BINDIR=/bin MANDIR=$GLAD/share/man/man1 install
	cd ../fmt
	make
	make DESTDIR=$GLAD BINDIR=/bin MANDIR=$GLAD/share/man/man1 install
	cd ../patch
	make
	make DESTDIR=$GLAD BINDIR=/bin MANDIR=$GLAD/share/man/man1 install
	cd ../sort
	make
	make DESTDIR=$GLAD BINDIR=/bin MANDIR=$GLAD/share/man/man1 install
	cd ../../bin/ls
	make
	make DESTDIR=$GLAD BINDIR=/bin MANDIR=$GLAD/share/man/man1 install
	cd ../pax
	make
	install -c pax $GLAD/bin
	cd $GLAD/bin
	ln -sfv pax cpio
	ln -sfv pax tar
	cd $TMPD/system/sources/$name/bin/pax
	install -c -m 444 cpio.1 $GLAD/share/man/man1
	install -c -m 444 pax.1 $GLAD/share/man/man1
	install -c -m 444 tar.1 $GLAD/share/man/man1
	cd ../stty
	make
	make DESTDIR=$GLAD BINDIR=/bin MANDIR=$GLAD/share/man/man1 install
}
